<html>
	<head>
        <link rel="shortcut icon" type="image/png" href="../frame/src/img/game-development.png"/>
	</head>
	<body>
		<canvas id=gc></canvas>
        <script src=../frame/src/js/gameFrame.js></script>
        <link rel=stylesheet href=../frame/src/css/main.css charset="utf-8">
        <script>
            var game = new Game("gc", 800, 600);
            game.control.setStep(10);
            game.canvas.setSolidBordersX(true);
            game.canvas.setSolidBordersY(true);
			setInterval(() => game.draw(drawing), 1000/60);

            var paddle = game.addElement(game.ELEMENT.RECT, "white", 100, 10, 350, 550);
            var ball = game.addElement(game.ELEMENT.RECT, "white", 10, 10, 395, 540);
           
            paddle.addListener("keydown", keydown);
            paddle.setIsSolid(true);
           
            ball.setXSpeed(0);
            ball.setYSpeed(0);
            ball.setIsSolid(true);
            
            var gameStarted = false;
            var brickWidth = 80;
            var brickHeight = 30;
            var bricks = [];
            
            generateBlocks(4, 7, 20, brickWidth, brickHeight);
			var drawing = function(){
                ball.print();
                paddle.print();
                
                ball.move('x');
                ball.move('y');
                paddle.x += game.control.x;
                
                ballPaddleCollision(ball.collide(paddle));
                for(var i in bricks){
                    bricks[i].print();
                    ballBrickCollision(ball.collide(bricks[i]),bricks[i], i);
                }
            };

            function ballBrickCollision(collided, brick, index){
                if(!collided || !gameStarted) return;

                bricks.splice(index, 1);
                game.removeElement(brick);

                // TODO: Improve brick collision
                ball.setYSpeed(-2);
            }

            function ballPaddleCollision(collided){
                if(!collided || !gameStarted) return;
                if(game.control.x < 0 && ball.xSpeed > 0) ball.setXSpeed(-2);
                if(game.control.x > 0 && ball.xSpeed < 0) ball.setXSpeed(2);
                ball.setYSpeed(-2);
            }

            function moveBall(){
                if(gameStarted) return;
                ball.setXSpeed(2);
                ball.setYSpeed(-2);
                gameStarted = true;
            }

            function generateBlocks(rows, columns, separation, brickWidth, brickHeight){
                bricks = [];
                var bricksSize = ((brickWidth+separation)*columns)-separation;
                var bricksStart = (game.canvas.width-bricksSize)/2;
                var yStart = 70;

                var bricksX = bricksStart;
                for(var i=0;i<rows; i++){
                    
                    for(var j=0;j<columns; j++){
                        bricks.push(game.addElement(game.ELEMENT.RECT, "white", brickWidth, brickHeight, bricksX, yStart))
                        bricksX += brickWidth+separation;
                    }
                    bricksX = bricksStart;
                    yStart += brickHeight+separation;
                }
            }            

			/* Custom listeners */
			function keydown(){
                moveBall();
            }
		</script>
    </body>
</html>